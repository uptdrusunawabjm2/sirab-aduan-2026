<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Tracking Aduan Rusunawa</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white min-h-screen flex items-center justify-center">

<div class="bg-slate-900 p-6 rounded-xl w-full max-w-xl shadow">
  <h1 class="text-xl font-bold mb-4 text-center">Tracking Aduan Rusunawa</h1>

  <div class="flex gap-2 mb-4">
    <input id="ticket" type="text" placeholder="Masukkan Submission ID"
      class="w-full p-2 rounded bg-slate-800 border border-slate-700">
    <button onclick="cek()" class="bg-blue-600 px-4 rounded hover:bg-blue-700">
      Cek
    </button>
  </div>

  <div id="hasil" class="hidden bg-slate-800 p-4 rounded text-sm space-y-1"></div>
  <div id="msg" class="text-center text-red-400 text-sm"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbwyiBhW4WoSehZ86jYH8CqW_k-GgTvVJ0QOkc1UT_4kXfY5cJZ0xGsMujELidj76TIcUg/exec";

async function cek() {
  const id = document.getElementById("ticket").value.trim();
  const hasil = document.getElementById("hasil");
  const msg = document.getElementById("msg");

  hasil.classList.add("hidden");
  msg.textContent = "Memuat...";

  if (!id) {
    msg.textContent = "Submission ID wajib diisi.";
    return;
  }

  try {
    const res = await fetch(`${API}?action=track&id=${encodeURIComponent(id)}`);
    const json = await res.json();

    if (!json.found) {
      msg.textContent = "Data tidak ditemukan.";
      return;
    }

    msg.textContent = "";
    hasil.innerHTML = render(json.header, json.data);
    hasil.classList.remove("hidden");

  } catch (e) {
    msg.textContent = "Gagal menghubungi server.";
  }
}

function render(header, row) {
  let html = "";
  header.forEach((h, i) => {
    if (!row[i]) return;
    if (h.toLowerCase().includes("foto")) {
      html += `<div><b>${h}:</b><br><a href="${row[i]}" target="_blank" class="text-blue-400 underline">Lihat Foto</a></div>`;
    } else {
      html += `<div><b>${h}:</b> ${row[i]}</div>`;
    }
  });
  return html;
}
</script>
</body>
</html>
