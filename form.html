<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Layanan Pengaduan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script src="https://www.google.com/recaptcha/api.js?render=6Lc_PVUsAAAAADxJEg2exDV55oy7A1ANSKGY9hXu"></script>

<style>
body{background:radial-gradient(circle at top,#0f172a,#020617);}
.card{backdrop-filter:blur(12px);background:linear-gradient(145deg,rgba(30,41,59,.92),rgba(15,23,42,.92));}
.input{width:100%;padding:14px;font-size:16px;background:#020617;border:1px solid #334155;border-radius:14px;color:white;}
.blockbox{border:1px solid #334155;border-radius:18px;padding:14px;background:#020617;}

.flatpickr-calendar{background:#f8fafc;color:#0f172a;border:1px solid #cbd5e1;border-radius:14px;}
.flatpickr-months, .flatpickr-weekdays{background:#e2e8f0;color:#0f172a;}
.flatpickr-day{color:#0f172a;border-radius:8px;}
.flatpickr-day.today{border:1px solid #0ea5e9;}
.flatpickr-day.selected{background:#0ea5e9;color:white;}
.flatpickr-day:hover{background:#bae6fd;}
</style>
</head>

<body class="text-white min-h-screen flex items-center justify-center p-3 md:p-6">

<div class="w-full max-w-4xl card border border-slate-800 rounded-2xl shadow-2xl p-4 md:p-8 space-y-6">

<div class="flex flex-col items-center text-center space-y-2">
  <img src="LOGO UPTD PNG PUTIH.png" class="w-20 md:w-28">
  <h1 class="text-xl md:text-3xl font-bold">Layanan Pengaduan</h1>
  <p class="text-slate-400 text-xs md:text-sm">terima kasih telah menghubungi layanan pengaduan</p>
</div>

<div class="space-y-4">

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
  <input id="nama" placeholder="Nama Lengkap" class="input">
  <input id="hp" placeholder="Nomor HP / WhatsApp" class="input">
  <input id="email" placeholder="Email Aktif" class="input">

  <select id="rusun" class="input">
    <option value="">Pilih Rusunawa</option>
    <option>Rusunawa Ganda Maghfirah</option>
    <option>Rusunawa Teluk Kelayan</option>
  </select>

  <input id="unit" placeholder="Nomor Unit / Sarusunawa" class="input md:col-span-2">
  <textarea id="laporan" rows="3" placeholder="Tuliskan isi laporan aduan..." class="input md:col-span-2"></textarea>
</div>

<div class="blockbox">
  <div class="text-cyan-400 font-semibold mb-2">ğŸ“… Janji Temu (Hari kerja)</div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
    <input id="janjiTanggal" placeholder="mm/dd/yyyy" class="input">
    <select id="janjiJam" class="input">
      <option value="">-- Pilih Jam --</option>
      <option value="08.00-09.30">08.00 - 09.30</option>
      <option value="09.30-12.00">09.30 - 12.00</option>
      <option value="13.30-15.00">13.30 - 15.00</option>
      <option value="15.00-16.30">15.00 - 16.30</option>
    </select>
  </div>
  <input type="hidden" id="janji">
</div>

<div class="blockbox border-dashed">
  <div class="text-emerald-400 font-semibold mb-2">ğŸ“· Upload Foto Dokumentasi</div>
  <input id="foto" type="file" multiple accept="image/*" class="text-sm">
</div>

<!-- PERNYATAAN RINGKAS -->
<div class="space-y-2 text-xs md:text-sm">

<label class="flex gap-2 bg-slate-900 border border-slate-700 rounded-xl p-3">
  <input type="checkbox" id="pernyataan1">
  <span>Saya menyatakan laporan pengaduan ini benar dan dapat dipertanggungjawabkan.</span>
</label>

<label class="flex gap-2 bg-slate-900 border border-slate-700 rounded-xl p-3">
  <input type="checkbox" id="pernyataan2">
  <span>Saya memahami dan menyetujui ketentuan pemeliharaan sarana dan prasarana rusunawa.</span>
</label>

<button onclick="openModal()" class="text-cyan-400 underline text-left">
ğŸ“„ Baca pernyataan lengkap
</button>

</div>

<button onclick="kirim()" class="w-full bg-gradient-to-r from-blue-600 to-cyan-500 py-3 rounded-xl font-bold">
ğŸ“© Kirim Aduan
</button>

<div id="msg" class="text-center text-sm"></div>

</div>
</div>

<!-- MODAL PERNYATAAN -->
<div id="modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center p-4 z-50">
<div class="bg-slate-900 border border-slate-700 rounded-2xl max-w-lg w-full p-4 space-y-3 text-sm overflow-auto max-h-[85vh]">

<h2 class="text-lg font-bold text-cyan-400">PERNYATAAN</h2>

<p>1. Saya menyatakan laporan pengaduan ini dibuat dengan sadar dan penuh tanggung jawab berdasarkan fakta yang benar.</p>
<p>2. Saya bersedia menerima sanksi hukum atau proses hukum apabila di kemudian hari ditemukan bahwa laporan ini tidak benar.</p>
<p>3. Saya menyatakan tidak ada informasi yang sengaja disembunyikan atau dimanipulasi.</p>

<hr class="border-slate-700">

<p class="font-semibold">Ketentuan Khusus Pemeliharaan Sarana dan Prasarana Rusunawa:</p>
<p>1. Apabila dalam hasil pemeriksaan ditemukan kerusakan akibat kelalaian penghuni, maka perbaikan dibebankan kepada penghuni.</p>
<p>2. Kerusakan akibat penyusutan bangunan dengan tingkat kerusakan sedang atau berat akan diperbaiki sesuai ketersediaan anggaran Pemerintah Kota Banjarmasin.</p>

<button onclick="closeModal()" class="w-full bg-blue-600 mt-3 py-2 rounded-xl font-semibold">
Tutup
</button>

</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwyiBhW4WoSehZ86jYH8CqW_k-GgTvVJ0QOkc1UT_4kXfY5cJZ0xGsMujELidj76TIcUg/exec";
const TRACKING="index.html";

/* DATE */
flatpickr("#janjiTanggal", {
  dateFormat: "m/d/Y",
  minDate: "today",
  disable: [d => d.getDay()==0 || d.getDay()==6]
});

janjiTanggal.onchange = buildJanji;
janjiJam.onchange = buildJanji;

function buildJanji(){
  janji.value = janjiTanggal.value && janjiJam.value ? janjiTanggal.value+" ("+janjiJam.value+")" : "";
}

function valid(){
  return nama.value && hp.value && email.value && rusun.value && laporan.value
         && pernyataan1.checked && pernyataan2.checked;
}

/* MODAL */
function openModal(){ modal.classList.remove("hidden"); modal.classList.add("flex"); }
function closeModal(){ modal.classList.add("hidden"); modal.classList.remove("flex"); }

/* KOMPRES FOTO */
async function compressImage(file, maxSize=1280, quality=0.7){
  return new Promise(res=>{
    const img=new Image(), r=new FileReader();
    r.onload=e=>{
      img.onload=()=>{
        let w=img.width, h=img.height;
        if(w>h && w>maxSize){ h*=maxSize/w; w=maxSize; }
        else if(h>maxSize){ w*=maxSize/h; h=maxSize; }
        const c=document.createElement("canvas");
        c.width=w; c.height=h;
        c.getContext("2d").drawImage(img,0,0,w,h);
        res(c.toDataURL("image/jpeg",quality));
      };
      img.src=e.target.result;
    };
    r.readAsDataURL(file);
  });
}

async function kirim(){
  if(!valid()){
    msg.textContent="â— Semua kolom wajib diisi dan kedua pernyataan harus dicentang";
    return;
  }

  msg.textContent="Mengompres foto...";

  grecaptcha.ready(async ()=>{
    const captcha = await grecaptcha.execute("6Lc_PVUsAAAAADxJEg2exDV55oy7A1ANSKGY9hXu",{action:"submit"});

    let files=[];
    for(let f of foto.files){
      const compressed = await compressImage(f);
      files.push({file:compressed.split(",")[1], mimeType:"image/jpeg"});
    }

    msg.textContent="Mengirim aduan...";

    const body={action:"create",captcha,nama:nama.value,hp:hp.value,email:email.value,
                rusun:rusun.value,unit:unit.value,laporan:laporan.value,
                janji:janji.value,pernyataan:"YA",files};

    const r=await fetch(API,{method:"POST",body:JSON.stringify(body)});
    const j=await r.json();

    if(j.success) location.href = TRACKING + "?ticket=" + j.id;
    else msg.textContent="âŒ " + (j.error || "Gagal mengirim aduan");
  });
}
</script>
</body>
</html>
